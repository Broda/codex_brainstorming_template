#!/usr/bin/env bash
set -euo pipefail

script_dir="$(cd -- "$(dirname -- "${BASH_SOURCE[0]}")" && pwd)"
uname_s="$(uname -s 2>/dev/null || echo unknown)"

if [[ "${OS:-}" == "Windows_NT" || "$uname_s" =~ ^(MINGW|MSYS|CYGWIN) ]]; then
  if command -v powershell >/dev/null 2>&1; then
    exec powershell -ExecutionPolicy Bypass -File "$script_dir/handoff-init.ps1" "$@"
  fi
  if command -v pwsh >/dev/null 2>&1; then
    exec pwsh -File "$script_dir/handoff-init.ps1" "$@"
  fi
  echo "Error: PowerShell is required on Windows but was not found." >&2
  exit 1
fi

exec "$script_dir/handoff-init.sh" "$@"
